{% liquid
  assign current_variant = product.selected_or_first_available_variant
  assign ratio_setting = section.settings.gallery_ratio | default: 'square'
  assign gallery_layout = section.settings.gallery_layout | default: 'thumbnail'
  assign media_size = section.settings.media_size | default: 'large'

  case ratio_setting
    when 'portrait'
      assign aspect_ratio = '3 / 4'
    when 'landscape'
      assign aspect_ratio = '4 / 3'
    when 'natural'
      assign aspect_ratio = 'auto'
    else
      assign aspect_ratio = '1 / 1'
  endcase
%}

<section class="container product-page layout-{{ gallery_layout }} ratio-{{ ratio_setting }} size-{{ media_size }}">
  <div class="product-gallery media-{{ gallery_layout }} size-{{ media_size }}">
    {% if product.media.size > 0 %}
      <div class="product-main-media"{% unless aspect_ratio == 'auto' %} style="aspect-ratio: {{ aspect_ratio }};"{% endunless %}>
        <img src="{{ current_variant.featured_image | default: product.featured_image | image_url: width: 1000 }}" alt="{{ product.title }}" loading="eager" style="width:100%;height:100%;object-fit:cover;">
      </div>
      <div class="product-grid">
        {% for media in product.media %}
          <div class="product-thumb"{% unless aspect_ratio == 'auto' %} style="aspect-ratio: {{ aspect_ratio }};"{% endunless %}>
            <img src="{{ media | image_url: width: 300 }}" alt="{{ media.alt | escape }}" loading="lazy" style="width:100%;height:100%;object-fit:cover;">
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
  <div class="product-info{% if section.settings.enable_sticky_info %} is-sticky{% endif %}">
    <div class="timer" data-timer="1200"><span>üî• Offre flash</span> <span><span data-minutes>20</span>m<span data-seconds>00</span>s</span></div>
    {% if section.settings.stock_message != blank %}
      <div class="stock-alert">{{ section.settings.stock_message }}</div>
    {% endif %}

    <form method="post" action="/cart/add" enctype="multipart/form-data" id="ProductForm-{{ section.id }}" data-variants='{{ product.variants | json | escape }}'>
      <input type="hidden" name="id" value="{{ current_variant.id }}" data-variant-id>
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'title' %}
            <h1 {{ block.shopify_attributes }}>{{ product.title }}</h1>
          {% when 'price' %}
            <div class="price" {{ block.shopify_attributes }}>{{ current_variant.price | money }}</div>
          {% when 'variant_selector' %}
            {% unless product.has_only_default_variant %}
              {% for option in product.options_with_values %}
                <label for="Option-{{ option.name }}">{{ option.name }}</label>
                <select id="Option-{{ option.name }}" name="options[{{ option.name }}]" data-option-index="{{ forloop.index0 }}">
                  {% for value in option.values %}
                    <option value="{{ value }}" {% if option.selected_value == value %}selected{% endif %}>{{ value }}</option>
                  {% endfor %}
                </select>
              {% endfor %}
            {% endunless %}
          {% when 'quantity' %}
            <label for="Quantity">Quantit√©</label>
            <input id="Quantity" class="quantity-input" type="number" name="quantity" value="1" min="1" max="10">
          {% when 'buy_buttons' %}
            <button type="submit" class="btn btn-primary" {% unless current_variant.available %}disabled{% endunless %} {{ block.shopify_attributes }}>{{ section.settings.cta_text }}</button>
          {% when 'description' %}
            <div {{ block.shopify_attributes }}>
              {{ product.description }}
            </div>
          {% when 'share' %}
            <div {{ block.shopify_attributes }}>
              <a href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url | append: product.url }}">Partager</a>
            </div>
        {% endcase %}
      {% endfor %}
    </form>

    {% render 'tripadvisor-badge', badge_title: section.settings.trip_title, badge_subtitle: section.settings.trip_subtitle, badge_count: section.settings.trip_count, badge_link: section.settings.trip_link %}

    <ul class="guarantees">
      <li>‚úì Garantie 30 jours satisfait ou rembours√©</li>
      <li>‚úì Paiements s√©curis√©s et crypt√©s</li>
      <li>‚úì Support humain 7/7 (FR / EN)</li>
    </ul>
  </div>
</section>

{% schema %}
{
  "name": "Produit avec preuves",
  "settings": [
    {"type": "text", "id": "cta_text", "label": "Texte bouton", "default": "Ajouter au panier"},
    {"type": "text", "id": "stock_message", "label": "Message stock bas", "default": "Stock limit√© : exp√©dition rapide"},
    {"type": "text", "id": "trip_title", "label": "Titre TripAdvisor", "default": "Recommand√© par TripAdvisor"},
    {"type": "text", "id": "trip_subtitle", "label": "Sous-titre TripAdvisor", "default": "Note moyenne 4,9/5"},
    {"type": "text", "id": "trip_count", "label": "Nombre d'avis", "default": "1 247"},
    {"type": "url", "id": "trip_link", "label": "Lien TripAdvisor", "default": "https://www.tripadvisor.com"},
    {"type": "checkbox", "id": "enable_sticky_info", "label": "Bloc info sticky", "default": true},
    {
      "type": "select",
      "id": "gallery_layout",
      "label": "Disposition galerie",
      "default": "thumbnail",
      "options": [
        {"value": "thumbnail", "label": "Vignettes"},
        {"value": "stacked", "label": "Empil√©e"},
        {"value": "grid", "label": "Grille"}
      ]
    },
    {
      "type": "select",
      "id": "gallery_ratio",
      "label": "Ratio des m√©dias",
      "default": "square",
      "options": [
        {"value": "square", "label": "Carr√©"},
        {"value": "portrait", "label": "Portrait"},
        {"value": "landscape", "label": "Paysage"},
        {"value": "natural", "label": "Naturel"}
      ]
    },
    {
      "type": "select",
      "id": "media_size",
      "label": "Taille d'affichage",
      "default": "large",
      "options": [
        {"value": "small", "label": "Petite"},
        {"value": "medium", "label": "Moyenne"},
        {"value": "large", "label": "Grande"}
      ]
    }
  ],
  "blocks": [
    {"type": "title", "name": "Titre"},
    {"type": "price", "name": "Prix"},
    {"type": "variant_selector", "name": "Variantes"},
    {"type": "quantity", "name": "Quantit√©"},
    {"type": "buy_buttons", "name": "Bouton d'achat"},
    {"type": "description", "name": "Description"},
    {"type": "share", "name": "Partage"}
  ],
  "presets": [{"name": "Produit"}]
}
{% endschema %}
